<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <h:head>

    </h:head>
    <h:body>
        <ui:composition>
                <p:growl life="3000" id="growlMessage" globalOnly="true"/>
                <p:dialog styleClass="editDialog" modal="true" widgetVar="dlgEditBook" dynamic="true" resizable="false" header="#{msg.edit_book}" closable="false" >
                    <p:panelGrid columns="2" columnClasses="col1, col2" styleClass="edit_book_table" >
                        <p:panel id="imagePanel">
                            <p:graphicImage value="#{bookListController.selectedBook.image}"
                                            width="110" height="150" id="bookImage"
                                            rendered="#{bookListController.editModeView}" cache="false"/>
                            <h:form enctype="multipart/form-data" id="formUploadImage" >
                                <p:fileUpload id="imageUpload" label="#{msg.load}" listener="#{bookListController.uploadImage}"
                                              update="bookNewImage" allowTypes="/(\.|\/)(gif|jpe?g|png)$/" multiple="false" auto="true"/>
                                <p:graphicImage cache="false" value="#{bookListController.uploadedImage}" library="images"
                                                width="110" height="150" id="bookNewImage" rendered="#{not empty bookListController.uploadedImage}"/>
                                <p:autoUpdate id="messagesImage"/>
                            </h:form>

                            <h:form enctype="multipart/form-data" id="formUploadPdf">
                                <p:fileUpload  id="pdfUpload" label="#{msg.load_pdf}" listener="#{bookListController.uploadContent}" update="@form"
                                               allowTypes="/(\.|\/)(pdf)$/" multiple="false" auto="true" styleClass="pdf-upload"/>
                                <h:outputLabel id="uploadedPdfLink" value="#{bookListController.uploadedContentName}"   />

                                <p:autoUpdate id="messages-pdf"/>
                          </h:form>
                        </p:panel>   
                        
                        <p:panel>
                            <h:form id="formEditBook"  rendered="#{bookListController.editModeView or bookListController.addModeView}">

                                <p:panelGrid id="bookDetails" columns="2" columnClasses="col1, col2" styleClass="edit_book_table">                   
                                    <strong>#{msg.book_name}: </strong>
                                    <p:inputText id="inputBookName" value="#{bookListController.selectedBook.name}" size="60"/>

                                    <strong>#{msg.author_name}: </strong>
                                    <h:selectOneMenu style="font-size: 12px;" value="#{bookListController.selectedBook.author}" converter="#{authorController}">
                                        <f:selectItems value="${authorController.selectItems}"/>
                                    </h:selectOneMenu>

                                    <strong>#{msg.genre}: </strong>
                                    <h:selectOneMenu style="font-size: 12px;"   value="#{bookListController.selectedBook.genre}" converter="#{genreController}">
                                        <f:selectItems value="${genreController.selectItems}"/>
                                    </h:selectOneMenu>

                                    <strong>#{msg.publisher} </strong>
                                    <h:selectOneMenu style="font-size: 12px;" value="#{bookListController.selectedBook.publisher}" converter="#{publisherController}">
                                        <f:selectItems value="${publisherController.selectItems}"/>
                                    </h:selectOneMenu>

                                    <strong>#{msg.publish_year} </strong>
                                    <p:inputText id="inputPublishYear" value="#{bookListController.selectedBook.publishDate}"/>

                                    <strong>#{msg.isbn} </strong>
                                    <p:inputText id="inputIsbn" value="#{bookListController.selectedBook.isbn}" />

                                    <strong>#{msg.page_count} </strong>
                                    <p:inputText id="inputPageCount" value="#{bookListController.selectedBook.pageCount}"  />  
                                    
                                    <p:outputLabel rendered="#{bookListController.editModeView}" value="#{msg.text}:" styleClass="edit-title"/>
                                    
                                    <h:outputLink value="#{request.contextPath}/PdfContent"  target="_blank" styleClass="pdf-link"  rendered="#{bookListController.editModeView}">                                                             
                                        <p:outputLabel value="#{msg.show_pdf}"/>
                                        <f:param name="id" value="#{bookListController.selectedBook.id}"/>
                                    </h:outputLink> 
                            
                                    <strong>#{msg.descr} </strong>
                                    <p:panel style="height: 180px;">
                                        <p:inputTextarea id="inputDescr" value="#{bookListController.selectedBook.descr}" cols="60" rows="10" maxlength="1500" counter="counter" counterTemplate="#{msg.letters_left} {0}" autoResize="false"/>
                                        <h:outputText id="counter" />  
                                    </p:panel>
                                    
                                <f:facet name="footer">
                                    <h:messages styleClass="error"/>    
                                    
                                    <p:commandButton styleClass="button-update" value="#{msg.save}" actionListener="#{bookListController.save}"
                                                     onclick="this.disabled=true;" update=":imagePanel :formEditBook :booksForm:booksList :booksCount :growlMessage">
                                    </p:commandButton>
                                    <p:commandButton action="#{bookListController.cancelEdit()}" value="#{msg.cancel}" immediate="true" global="false">
                                    </p:commandButton>
                                </f:facet>
                                </p:panelGrid>
                            </h:form>
                        </p:panel>
                    </p:panelGrid>
                </p:dialog>
        </ui:composition>
    </h:body>
</html>

